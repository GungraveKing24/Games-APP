{% extends "base.html" %}

{% block title %}Galería de Imágenes{% endblock title %}

{% block style %}
<style>
    .justified-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 10px; /* Espaciado entre imágenes */
    }

    .item img {
        display: block;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Sombra opcional */
    }
</style>
{% endblock style %}

{% block content %}
<div class="container mx-auto p-4">
    <h2>{{ folder_name }}</h2>
    <div class="justified-grid" id="justifiedGrid">
        {% for image in images_urls %}
            <div class="item">
                <img src="{{ image.url }}" alt="Imagen" loading="lazy" data-width="{{ image.width }}" data-height="{{ image.height }}">
            </div>
        {% endfor %}
    </div>
</div>
{% endblock content %}

{% block script %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById('justifiedGrid');
        const gap = 10; // Espaciado entre imágenes
        const rowHeight = 300; // Altura deseada para las filas

        function layoutImages() {
            const items = Array.from(container.querySelectorAll(".item img"));
            let row = [];
            let rowWidth = 0;

            // Calcular las proporciones y ajustar el layout
            items.forEach((img, index) => {
                const aspectRatio = img.dataset.width / img.dataset.height;
                const targetWidth = rowHeight * aspectRatio;

                row.push({ img, targetWidth, aspectRatio });
                rowWidth += targetWidth + gap;

                // Si la fila supera el ancho del contenedor o es la última imagen
                if (rowWidth > container.clientWidth || index === items.length - 1) {
                    const scale = (container.clientWidth - gap * (row.length - 1)) / rowWidth;
                    row.forEach(({ img, targetWidth }) => {
                        img.style.width = `${targetWidth * scale}px`;
                        img.style.height = `${rowHeight * scale}px`;
                    });
                    row = [];
                    rowWidth = 0;
                }
            });
        }

        window.addEventListener("resize", layoutImages);
        layoutImages();
    });
</script>
{% endblock script %}
